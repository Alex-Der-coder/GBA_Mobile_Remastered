"use strict";importScripts("../../includes/TypedArrayShim.js"),importScripts("Renderer.js"),importScripts("BGTEXT.js"),importScripts("BG2FrameBuffer.js"),importScripts("BGMatrix.js"),importScripts("AffineBG.js"),importScripts("ColorEffects.js"),importScripts("Mosaic.js"),importScripts("OBJ.js"),importScripts("OBJWindow.js"),importScripts("Window.js"),importScripts("Compositor.js");var renderer=null,gfxBuffers=null,gfxCounters=null,gfxCommandBuffer=null,gfxCommandCounters=null,gfxCommandBufferMask=1,gfxLineCounter=null,gfxLinesCPU=0,gfxLinesGPU=0;function copyBuffer(e){var r=0|Atomics.load(gfxCounters,0),a=0|gfxCounters[1];(0|a)!=(2+(0|r)|0)&&(gfxBuffers[1&a].set(e),Atomics.store(gfxCounters,1,1+(0|a)|0))}function waitForVSync(){for(;0==(0|Atomics.load(gfxCommandCounters,2));)processCommands(),Atomics.wait(gfxCounters,2,0);processCommands()}function initializeRenderer(e){e=!!e,renderer=new GameBoyAdvanceGraphicsRendererOffthread(!!e)}function assignStaticBuffers(e,r,a){gfxBuffers=e,gfxCounters=r,gfxLineCounter=a}function assignDynamicBuffers(e,r){gfxCommandCounters=r;var a=0|(gfxCommandBuffer=e).length;gfxCommandBufferMask=(0|a)-1|0}function processCommands(){var e=0|gfxCommandCounters[0],r=0|Atomics.load(gfxCommandCounters,1);if(gfxLinesCPU=0|Atomics.load(gfxLineCounter,0),(0|r)!=(0|e)){var a=e&gfxCommandBufferMask,n=r&gfxCommandBufferMask;do{dispatchCommand(0|gfxCommandBuffer[0|a],0|gfxCommandBuffer[1|a]),a=2+(0|a)&gfxCommandBufferMask}while((0|a)!=(0|n));Atomics.store(gfxCommandCounters,0,0|r)}}function dispatchCommand(e,r){switch(r|=0,(e|=0)>>16){case 0:dispatchIOCommand(0|e,0|r);break;case 1:renderer.writeVRAM16(65535&e,0|r);break;case 2:renderer.writeVRAM32(32767&e,0|r);break;case 3:renderer.writePalette16(511&e,0|r);break;case 4:renderer.writePalette32(255&e,0|r);break;case 5:renderer.writeOAM16(511&e,0|r);break;default:renderer.writeOAM32(255&e,0|r)}}function dispatchIOCommand(e,r){switch(r|=0,0|(e|=0)){case 0:decodeInternalCommand(0|r);break;case 1:renderer.writeDISPCNT8_0(0|r);break;case 2:renderer.writeDISPCNT8_1(0|r);break;case 3:renderer.writeDISPCNT8_2(0|r);break;case 4:renderer.writeDISPCNT16(0|r);break;case 5:renderer.writeDISPCNT32(0|r);break;case 6:renderer.writeBG0CNT8_0(0|r);break;case 7:renderer.writeBG0CNT8_1(0|r);break;case 8:renderer.writeBG0CNT16(0|r);break;case 9:renderer.writeBG1CNT8_0(0|r);break;case 10:renderer.writeBG1CNT8_1(0|r);break;case 11:renderer.writeBG1CNT16(0|r);break;case 12:renderer.writeBG0BG1CNT32(0|r);break;case 13:renderer.writeBG2CNT8_0(0|r);break;case 14:renderer.writeBG2CNT8_1(0|r);break;case 15:renderer.writeBG2CNT16(0|r);break;case 16:renderer.writeBG3CNT8_0(0|r);break;case 17:renderer.writeBG3CNT8_1(0|r);break;case 18:renderer.writeBG3CNT16(0|r);break;case 19:renderer.writeBG2BG3CNT32(0|r);break;case 20:renderer.writeBG0HOFS8_0(0|r);break;case 21:renderer.writeBG0HOFS8_1(0|r);break;case 22:renderer.writeBG0HOFS16(0|r);break;case 23:renderer.writeBG0VOFS8_0(0|r);break;case 24:renderer.writeBG0VOFS8_1(0|r);break;case 25:renderer.writeBG0VOFS16(0|r);break;case 26:renderer.writeBG0OFS32(0|r);break;case 27:renderer.writeBG1HOFS8_0(0|r);break;case 28:renderer.writeBG1HOFS8_1(0|r);break;case 29:renderer.writeBG1HOFS16(0|r);break;case 30:renderer.writeBG1VOFS8_0(0|r);break;case 31:renderer.writeBG1VOFS8_1(0|r);break;case 32:renderer.writeBG1VOFS16(0|r);break;case 33:renderer.writeBG1OFS32(0|r);break;case 34:renderer.writeBG2HOFS8_0(0|r);break;case 35:renderer.writeBG2HOFS8_1(0|r);break;case 36:renderer.writeBG2HOFS16(0|r);break;case 37:renderer.writeBG2VOFS8_0(0|r);break;case 38:renderer.writeBG2VOFS8_1(0|r);break;case 39:renderer.writeBG2VOFS16(0|r);break;case 40:renderer.writeBG2OFS32(0|r);break;case 41:renderer.writeBG3HOFS8_0(0|r);break;case 42:renderer.writeBG3HOFS8_1(0|r);break;case 43:renderer.writeBG3HOFS16(0|r);break;case 44:renderer.writeBG3VOFS8_0(0|r);break;case 45:renderer.writeBG3VOFS8_1(0|r);break;case 46:renderer.writeBG3VOFS16(0|r);break;case 47:renderer.writeBG3OFS32(0|r);break;case 48:renderer.writeBG2PA8_0(0|r);break;case 49:renderer.writeBG2PA8_1(0|r);break;case 50:renderer.writeBG2PA16(0|r);break;case 51:renderer.writeBG2PB8_0(0|r);break;case 52:renderer.writeBG2PB8_1(0|r);break;case 53:renderer.writeBG2PB16(0|r);break;case 54:renderer.writeBG2PAB32(0|r);break;case 55:renderer.writeBG2PC8_0(0|r);break;case 56:renderer.writeBG2PC8_1(0|r);break;case 57:renderer.writeBG2PC16(0|r);break;case 58:renderer.writeBG2PD8_0(0|r);break;case 59:renderer.writeBG2PD8_1(0|r);break;case 60:renderer.writeBG2PD16(0|r);break;case 61:renderer.writeBG2PCD32(0|r);break;case 62:renderer.writeBG3PA8_0(0|r);break;case 63:renderer.writeBG3PA8_1(0|r);break;case 64:renderer.writeBG3PA16(0|r);break;case 65:renderer.writeBG3PB8_0(0|r);break;case 66:renderer.writeBG3PB8_1(0|r);break;case 67:renderer.writeBG3PB16(0|r);break;case 68:renderer.writeBG3PAB32(0|r);break;case 69:renderer.writeBG3PC8_0(0|r);break;case 70:renderer.writeBG3PC8_1(0|r);break;case 71:renderer.writeBG3PC16(0|r);break;case 72:renderer.writeBG3PD8_0(0|r);break;case 73:renderer.writeBG3PD8_1(0|r);break;case 74:renderer.writeBG3PD16(0|r);break;case 75:renderer.writeBG3PCD32(0|r);break;case 76:renderer.writeBG2X8_0(0|r);break;case 77:renderer.writeBG2X8_1(0|r);break;case 78:renderer.writeBG2X8_2(0|r);break;case 79:renderer.writeBG2X8_3(0|r);break;case 80:renderer.writeBG2X16_0(0|r);break;case 81:renderer.writeBG2X16_1(0|r);break;case 82:renderer.writeBG2X32(0|r);break;case 83:renderer.writeBG2Y8_0(0|r);break;case 84:renderer.writeBG2Y8_1(0|r);break;case 85:renderer.writeBG2Y8_2(0|r);break;case 86:renderer.writeBG2Y8_3(0|r);break;case 87:renderer.writeBG2Y16_0(0|r);break;case 88:renderer.writeBG2Y16_1(0|r);break;case 89:renderer.writeBG2Y32(0|r);break;case 90:renderer.writeBG3X8_0(0|r);break;case 91:renderer.writeBG3X8_1(0|r);break;case 92:renderer.writeBG3X8_2(0|r);break;case 93:renderer.writeBG3X8_3(0|r);break;case 94:renderer.writeBG3X16_0(0|r);break;case 95:renderer.writeBG3X16_1(0|r);break;case 96:renderer.writeBG3X32(0|r);break;case 97:renderer.writeBG3Y8_0(0|r);break;case 98:renderer.writeBG3Y8_1(0|r);break;case 99:renderer.writeBG3Y8_2(0|r);break;case 100:renderer.writeBG3Y8_3(0|r);break;case 101:renderer.writeBG3Y16_0(0|r);break;case 102:renderer.writeBG3Y16_1(0|r);break;case 103:renderer.writeBG3Y32(0|r);break;case 104:renderer.writeWIN0XCOORDRight8(0|r);break;case 105:renderer.writeWIN0XCOORDLeft8(0|r);break;case 106:renderer.writeWIN0XCOORD16(0|r);break;case 107:renderer.writeWIN1XCOORDRight8(0|r);break;case 108:renderer.writeWIN1XCOORDLeft8(0|r);break;case 109:renderer.writeWIN1XCOORD16(0|r);break;case 110:renderer.writeWINXCOORD32(0|r);break;case 111:renderer.writeWIN0YCOORDBottom8(0|r);break;case 112:renderer.writeWIN0YCOORDTop8(0|r);break;case 113:renderer.writeWIN0YCOORD16(0|r);break;case 114:renderer.writeWIN1YCOORDBottom8(0|r);break;case 115:renderer.writeWIN1YCOORDTop8(0|r);break;case 116:renderer.writeWIN1YCOORD16(0|r);break;case 117:renderer.writeWINYCOORD32(0|r);break;case 118:renderer.writeWIN0IN8(0|r);break;case 119:renderer.writeWIN1IN8(0|r);break;case 120:renderer.writeWININ16(0|r);break;case 121:renderer.writeWINOUT8(0|r);break;case 122:renderer.writeWINOBJIN8(0|r);break;case 123:renderer.writeWINOUT16(0|r);break;case 124:renderer.writeWINCONTROL32(0|r);break;case 125:renderer.writeMOSAIC8_0(0|r);break;case 126:renderer.writeMOSAIC8_1(0|r);break;case 127:renderer.writeMOSAIC16(0|r);break;case 128:renderer.writeBLDCNT8_0(0|r);break;case 129:renderer.writeBLDCNT8_1(0|r);break;case 130:renderer.writeBLDCNT16(0|r);break;case 131:renderer.writeBLDALPHA8_0(0|r);break;case 132:renderer.writeBLDALPHA8_1(0|r);break;case 133:renderer.writeBLDALPHA16(0|r);break;case 134:renderer.writeBLDCNT32(0|r);break;default:renderer.writeBLDY8(0|r)}}function decodeInternalCommand(e){if(0==(0|(e|=0)))((0|gfxLinesCPU)-(0|gfxLinesGPU)|0)<480?renderer.renderScanLine():renderer.updateReferenceCounters(),renderer.incrementScanLine(),gfxLinesGPU=1+(0|gfxLinesGPU)|0;else((0|gfxLinesCPU)-(0|gfxLinesGPU)|0)<480&&renderer.prepareFrame()}self.onmessage=function(e){var r=e.data;switch(0|r.messageID){case 0:assignStaticBuffers(r.gfxBuffers,r.gfxCounters,r.gfxLineCounter);break;case 1:initializeRenderer(!!r.skippingBIOS);break;default:assignDynamicBuffers(r.gfxCommandBuffer,r.gfxCommandCounters),waitForVSync()}};
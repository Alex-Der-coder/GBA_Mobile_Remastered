"use strict";function iodineGBAWorkerShim(){this.playStatus=null,this.gfx=null,this.audio=null,this.speed=null,this.saveExport=null,this.saveImport=null,this.worker=null,this.gfxBuffers=null,this.gfxCounters=null,this.audioBuffer=null,this.audioCounters=null,this.audioSamplesRemaining=null,this.audioBufferSize=0,this.audioBufferSizeMask=0,this.audioInitialized=!1,this.timestamp=null,this.initialize()}var tempvar=document.getElementsByTagName("script");iodineGBAWorkerShim.prototype.filepath=tempvar[tempvar.length-1].src,iodineGBAWorkerShim.prototype.initialize=function(){var e=this,i=this.filepath.split("/");i=i.slice(0,i.length-2).join("/"),i+="/iodineGBA/core/Worker.js",this.worker=new Worker(i),this.worker.onmessage=function(i){e.decodeMessage(i.data)}},iodineGBAWorkerShim.prototype.sendMessageSingle=function(e){e|=0,this.worker.postMessage({messageID:e})},iodineGBAWorkerShim.prototype.sendMessageDouble=function(e,i){e|=0,this.worker.postMessage({messageID:e,payload:i})},iodineGBAWorkerShim.prototype.play=function(){this.sendMessageSingle(0)},iodineGBAWorkerShim.prototype.pause=function(){this.sendMessageSingle(1)},iodineGBAWorkerShim.prototype.restart=function(){this.sendMessageSingle(2)},iodineGBAWorkerShim.prototype.setIntervalRate=function(e){e=+e,this.sendMessageDouble(3,+e)},iodineGBAWorkerShim.prototype.timerCallback=function(e){e>>>=0,this.timestamp&&Atomics.store(this.timestamp,0,e>>>0)},iodineGBAWorkerShim.prototype.attachPlayStatusHandler=function(e){this.playStatus=e,this.sendMessageSingle(23)},iodineGBAWorkerShim.prototype.issuePlayStatus=function(e){e|=0,this.playStatus&&this.playStatus(0|e)},iodineGBAWorkerShim.prototype.attachGraphicsFrameHandler=function(e){this.gfx=e;var i=this;this.gfx.attachGfxCallback((function(){i.graphicsHeartBeat()})),this.sendMessageSingle(4)},iodineGBAWorkerShim.prototype.attachAudioHandler=function(e){this.audio=e,this.sendMessageSingle(5)},iodineGBAWorkerShim.prototype.enableAudio=function(){this.audio&&this.sendMessageSingle(6)},iodineGBAWorkerShim.prototype.disableAudio=function(){this.audio&&this.sendMessageSingle(7)},iodineGBAWorkerShim.prototype.toggleSkipBootROM=function(e){e|=0,this.sendMessageDouble(8,0|e)},iodineGBAWorkerShim.prototype.toggleDynamicSpeed=function(e){e|=0,this.sendMessageDouble(9,0|e)},iodineGBAWorkerShim.prototype.toggleOffthreadGraphics=function(e){e|=0,this.sendMessageDouble(22,0|e)},iodineGBAWorkerShim.prototype.attachSpeedHandler=function(e){this.speed=e,this.sendMessageSingle(10)},iodineGBAWorkerShim.prototype.keyDown=function(e){e|=0,this.sendMessageDouble(11,0|e)},iodineGBAWorkerShim.prototype.keyUp=function(e){e|=0,this.sendMessageDouble(12,0|e)},iodineGBAWorkerShim.prototype.incrementSpeed=function(e){e=+e,this.sendMessageDouble(13,+e)},iodineGBAWorkerShim.prototype.setSpeed=function(e){e=+e,this.sendMessageDouble(14,+e)},iodineGBAWorkerShim.prototype.attachBIOS=function(e){this.sendMessageDouble(15,e)},iodineGBAWorkerShim.prototype.attachROM=function(e){this.sendMessageDouble(16,e)},iodineGBAWorkerShim.prototype.exportSave=function(){this.sendMessageSingle(17)},iodineGBAWorkerShim.prototype.attachSaveExportHandler=function(e){this.saveExport=e,this.sendMessageSingle(18)},iodineGBAWorkerShim.prototype.attachSaveImportHandler=function(e){this.saveImport=e,this.sendMessageSingle(19)},iodineGBAWorkerShim.prototype.decodeMessage=function(e){switch(0|e.messageID){case 0:this.buffersInitialize(e.gfxBuffer1,e.gfxBuffer2,e.gfxCounters,e.audioSamplesRemaining,e.timestamp);break;case 1:this.audioInitialize(0|e.channels,+e.sampleRate,0|e.bufferLimit,e.audioBuffer,e.audioCounters);break;case 2:this.audioRegister();break;case 3:this.audioUnregister();break;case 4:this.audioSetBufferSpace(0|e.audioBufferContainAmount);break;case 5:this.saveImportRequest(e.saveID);break;case 6:this.saveExportRequest(e.saveID,e.saveData);break;case 7:this.speedPush(+e.speed);break;default:this.issuePlayStatus(0|e.playing)}},iodineGBAWorkerShim.prototype.audioInitialize=function(e,i,t,o,s){e|=0,i=+i,t|=0;var r=this;this.audio&&(this.audio.initialize(0|e,+i,0|t,(function(){r.audioHeartBeat()}),(function(){r.audioPostHeartBeat()}),(function(){r.disableAudio()})),this.audioInitialized=!0),this.audioBuffer=o,this.audioCounters=s,this.audioBufferSize=0|o.length,this.audioBufferSizeMask=(0|this.audioBufferSize)-1|0},iodineGBAWorkerShim.prototype.audioHeartBeat=function(){this.audioInitialized&&this.consumeAudioBuffer()},iodineGBAWorkerShim.prototype.consumeAudioBuffer=function(){var e=0|this.audioCounters[0],i=0|Atomics.load(this.audioCounters,1);(0|i)!=(0|e)&&(this.copyAudioBuffer(0|e,0|i),this.audioPostHeartBeat(),Atomics.store(this.audioCounters,0,0|i),this.audio.flush())},iodineGBAWorkerShim.prototype.copyAudioBuffer=function(e,i){i|=0;var t=(0|(e|=0))&(0|this.audioBufferSizeMask)|0,o=(0|i)&(0|this.audioBufferSizeMask)|0;(0|t)>=(0|o)?(this.audio.pushDeferred(this.audioBuffer,0|t,0|this.audioBufferSize),this.audio.pushDeferred(this.audioBuffer,0,0|o)):this.audio.pushDeferred(this.audioBuffer,0|t,0|o)},iodineGBAWorkerShim.prototype.audioPostHeartBeat=function(){this.audioSamplesRemaining[0]=0|this.audio.remainingBuffer()},iodineGBAWorkerShim.prototype.graphicsHeartBeat=function(){this.gfx&&this.gfxCounters&&(this.consumeGraphicsBuffer(),Atomics.notify(this.gfxCounters,2,1))},iodineGBAWorkerShim.prototype.consumeGraphicsBuffer=function(){var e=0|this.gfxCounters[0],i=0|Atomics.load(this.gfxCounters,1);if((0|i)!=(0|e)){do{this.gfx.copyBuffer(this.gfxBuffers[1&e]),e=1+(0|e)|0}while((0|e)!=(0|i));this.gfxCounters[0]=0|i}},iodineGBAWorkerShim.prototype.audioRegister=function(){this.audio&&this.audio.register()},iodineGBAWorkerShim.prototype.audioUnregister=function(){this.audio&&(this.audioHeartBeat(),this.audio.unregister())},iodineGBAWorkerShim.prototype.audioSetBufferSpace=function(e){e|=0,this.audio&&this.audio.setBufferSpace(0|e)},iodineGBAWorkerShim.prototype.buffersInitialize=function(e,i,t,o,s){this.gfxBuffers=[e,i],this.gfxCounters=t,this.audioSamplesRemaining=o,this.timestamp=s},iodineGBAWorkerShim.prototype.speedPush=function(e){e=+e,this.speed&&this.speed(+e)},iodineGBAWorkerShim.prototype.saveImportRequest=function(e){if(this.saveImport){var i=this;this.saveImport(e,(function(e){i.sendMessageDouble(20,e)}),(function(){i.sendMessageSingle(21)}))}},iodineGBAWorkerShim.prototype.saveExportRequest=function(e,i){this.saveExport&&this.saveExport(e,i)};